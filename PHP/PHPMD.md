PHPMD(`PHP Mess Detector`)はPHPの静的解析ツールで、  
実態は`PHPDepend`のスピンオフプロジェクト。

`PHPDepend`をよりユーザーにとって使いやすく、  
解析結果を見やすいようにするサポートツールといったイメージ。

* 未使用の変数・メソッドなどの検知
* コードの複雑度測定
* 一般的に良くないとされる書き方の検知

などを解析し、さまざまな形式で出力できる。

## インストール
composerによって導入可能。  
依存関係を`composer.json`に追加し、`composer update`でインストールする。
```json
"require-dev": {
	"phpmd/phpmd" : "@stable"
},
```

## 基本の使い方
composerのディレクトリ内の`vender/bin/phpmd`がコマンドになっている。  
解析ディレクトリ以下を全て解析するため、基本はプロジェクトのルートディレクトリでOK。
```bash
./vender/bin/phpmd [各種オプション] [解析するディレクトリ] [出力形式] [解析ルール指定]
```

## 出力形式
以下のような形式が指定できる。

* text ... 普通のテキストファイルで出力
* xml ... xml形式で出力
* checkstyle ... 出力はxmlだが、他の言語やツールに依存しない形式に直す
* json ... json形式で出力
* html ... htmlで出力
  - 加工せずともある程度見やすいが、表示上の問題が発生する可能性あり
* github ... `GitHub Actions`で使える形式で出力

## 解析ルール指定
デフォルトで用意されているもののほか、自分で作成することも可能。  
デフォルトには以下のようなものがある。

* cleancode
* codesize
* design

### cleancode
修正することで可読性が増すようなコードの書き方を検知する。

* if文の`()`内で変数に代入をしない方が良い
* `else`句の使用はできるだけ避ける方が良い

### codesize
ソースコードがどのくらい複雑になってしまっているかを計測する。  
一定以上の数値が出たものが出力されるため、特に複雑な処理を確認しやすい。  

あくまでもメソッド内しか計測しないようなので注意。  
メソッドになっていない（グローバルスコープ）部分が複雑になっていても検知されない。

* CyclomaticComplexity（循環的複雑度）
  - メソッド内で、ifなどの条件文・for文などのループの数によって算出される複雑度
* NPathComplexity（実行パス複雑度）
  - メソッド内の実行パスの経路数を表す。条件判定やループの数によって大きく増加する
* ExcessiveParameterList（多すぎるパラメータ）
  - メソッドのパラメータが一定以上の場合に出力される
* ExcessiveMethodLength（長すぎるメソッド）
  - メソッドの長さが一定以上の場合に出力される

## オプション
* `--suffixes` ... 解析対象のファイル形式を指定する
  - コンマ区切り（例：`--suffixes "php,inc"`）
* `--exclude` ... 解析から除外するディレクトリ・ファイルを指定する
  - ワイルドカード（`*`）も使用可能