# Androidバックグラウンド処理
## バックグラウンド処理とは
アプリにはメインスレッドが存在し、例えばゲームならば  
そこでメインのループを回して各処理を行う。

しかしメインスレッドは1つしかなく、ネットへの通信処理などがメインスレッドで行われると  
通信が終わるまでそこで処理が止まることになってしまう。

そこで、メインスレッドとは**別のスレッドを作って**、時間のかかる処理をそちらで行う（非同期処理）ことで  
メインスレッドの処理を妨げることなく通信処理などを行うことができる。

また、アプリの終了後も実行するような処理（定期的にサーバーと通信してデータを同期等）や、  
指定した時間になったら実行するような処理（push通知等）  
を行いたい場合にもこれは使用する。

## バックグラウンド処理ライブラリ
Androidにはバックグラウンドで処理を行うためのライブラリが複数存在する。  
それぞれ微妙な差があり、場合によって使い分けていくことになる。

### WorkManager
Androidで提供されている非同期処理の各種ライブラリを、AndroidのAPIバージョンに応じて内部で使い分けて  
非同期処理を実現するライブラリ。

APIバージョンに応じて使用するライブラリを切り替えるため、下位バージョンとの互換性に優れる。  
ただし、即時実行する必要があったりバックグラウンド処理中にアプリが強制終了しても安全に終了させたいような場合には  
他のライブラリの使用が推奨されている。

### DownloadManager
HTTPによるファイル等のダウンロードを行うことに特化したライブラリ。  
ダウンロード先のURIなどの各種設定（`Request`）を積んでいき、開始するとバックグラウンドで通信してくれる。

基本的に即時実行されるため、数時間後に実行したいような場合には使いづらい。

### AlarmManager
指定した時間に、正確に処理をしたい場合に有効なライブラリ。  
基本的に時間指定のバックグラウンド処理は多少のズレが生じることが多いのだが、  
AlarmManagerを使うことで正確な時間での処理が期待できる。（AlarmManagerでも使うメソッドによってはズレるが…）

メソッドを呼んだタイミングで即時実行したい場合には他のライブラリの方が有効。

### フォアグラウンドサービス
バックグラウンドで何かしらの動作をさせる場合に使われる「サービス」のひとつ。  
主に音楽を再生したり、ファイルの読み書きを行う際に使われる。  

フォアグラウンドサービスはユーザーが認識できる操作を表し、「通知」を表示しなければならない。  
※「通知」…Androidの画面上部に出る通知のアイコン等のこと

基本的には即時実行でアプリが起動している時に動作させる。  
時間指定で起動したりはできないため、時間指定での実行や定期実行したい処理には向かない。