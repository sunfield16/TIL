# APNs
`Apple Push Notification service`は、Appleが提供する  
リモートのプッシュ通知サービス。

APNsを利用すると、アプリをインストールしている端末に対して  
リモートで通知を送ることができる。

## 通知の例
メッセージングアプリであれば、新しいメッセージが送られた時に  
合わせて通知を送ることでユーザーに知らせることができる。

ゲームアプリであれば、ガチャ更新やイベントが開始した時に  
合わせて通知を送ることでユーザーへ周知できる。

## 通知の流れ
1. 送信元からAPNsにリクエストを送信
2. APNsから指定の端末に通知を行う
3. 端末が通知を受け取り、内容を表示 

# 通知に必要なもの
* プッシュ通知機能の有効化
* デバイストークン
* プッシュ通知用の証明書

## プッシュ通知機能の有効化
Provisioning Profileでプッシュ通知機能が有効化されていなければ、  
そのアプリでAPNsを利用できない。

## デバイストークン
端末に通知を送るためには、アプリ内で取得できるデバイストークンが必要になる。  
APNsへのリクエストにデバイストークンを紐づけて送ることで、その端末に  
通知が送られるようになっている。

基本的にはアプリのサーバー等にデバイストークンを送信し、ユーザーごとに紐づけて  
管理することになる。

デバイストークンは定期的に再生成されるため、ログイン時などに  
毎回取得するのがよいとされている。

## プッシュ通知用の証明書
APNsのリクエストにはプッシュ通知用の証明書が必要になる。  
`ApplePush Notification Service SSL（Sandbox＆Production）`  
という専用の証明書タイプがあるので、これを作成する。

1. Apple Developerアカウントにログイン
2. 対象のアプリに紐づいた、プッシュ通知用の証明書を作成
3. 秘密鍵を、Push通知の送信元になるサーバーに配置

## リクエストを送信する
リクエストのURLは開発環境用と本番用がある。  
アプリに含めたProvisioning Profileから、どちらを使用すべきか判断できる。  
（`Entitlements`の`aps-environment`を参照する）