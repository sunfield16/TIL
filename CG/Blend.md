## 画像ブレンド
CGでは複数の画像が重なった場合に、様々な計算を行って  
最終的に描画される色を決める必要がある。  
画像ブレンドはこの計算の方法を指す。

様々な方法があり、場合に応じた使い分けが必要になる。

## 用語
* src ... 画像が重なった時、前に表示されている画像(前景)
* dst ... 画像が重なった時、後ろに表示されている画像(背景)
* RGB ... 各ピクセルRed, Green, Blueそれぞれの数値
* アルファ値(Alpha, A) ... 各ピクセルの透明度を表す(0.0 ~ 1.0)
  - 低いほど透明になる

## 基本の計算
各ピクセルごとにRGBとAlphaがあるとした場合、最終的な描画色は  
下記のような計算になる。

```
outRGB   = [srcRGB] * [ブレンドによる数値] + [dstRGB] * [ブレンドによる数値]
outAlpha = [srcAlpha] + [dstAlpha] * [ブレンドによる数値]
```

## アルファブレンド
一般的によく使われるブレンド方法。  
前景のアルファ値が低い箇所が透けて、背景の色が出てくる。

```
outRGB = [srcRGB] * [srcAlpha] + [dstRGB] * [1 - srcAlpha]
outAlpha = [srcAlpha] + [dstAlpha] * [1 - srcAlpha]
```

```
例:
srcRGBA = (255, 0, 0, 0.5)
dstRGBA = (0, 0, 255, 1)
の場合

outRGB = (255, 0, 0) * 0.5 + (0, 0, 255) * (1 - 0.5)
       = (127, 0, 0) + (0, 0, 127)
       = (127, 0, 127)
outAlpha = 0.5 + (1 - 0.5)
         = 1

outRGBA = (127, 0, 127, 1)
※前景の赤が半分透けて背景の青に混ざり、紫になった
```

```
例2:
srcRGBA = (255, 0, 0, 1)
dstRGBA = (0, 0, 255, 1)
の場合

outRGB = (255, 0, 0) * 1 + (0, 0, 255) * (1 - 1)
       = (255, 0, 0) + (0, 0, 0)
       = (255, 0, 0)
outAlpha = 1 + 1 - 1
         = 1
※前景の赤のアルファ値が 1 で透けないため、最終的に赤がそのまま描画される
```

### 乗算済みアルファ
乗算済みアルファは、前景の画像にアルファ値をあらかじめ掛けておくことで  
アルファブレンドの時に計算量を減らす技術。

先程の例では下記のようになる。

```
例:
srcRGBA = (255, 0, 0, 0.5)
↓ 先にアルファ値を掛ける
srcRGBA = (127, 0, 0, 0.5)

dstRGBA = (0, 0, 255, 1)
↓ 先にアルファ値を掛ける
dstRGBA = (0, 0, 255, 1)

outRGB = (127, 0, 0) + (0, 0, 255) * (1 - 0.5)
       = (127, 0, 0) + (0, 0, 127)
       = (127, 0, 127)
```