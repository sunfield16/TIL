# 正規表現(Regular expression)
## 参考資料
初心者歓迎！手と目で覚える正規表現入門  
<https://qiita.com/jnchito/items/893c887fbf19e17d3ff9>

## 正規表現とは何か
* 文字列の検索・置換などに使用するプログラム言語のようなもの（として捉えるとわかりやすいかも）

## 正規表現を表してみる
正規表現は基本的に`/`で囲んだ中に書いていく。

```
/\d{2,5}[-(]\d{1,4}[-)]\d{4}/
```

こんな感じになる。両端が`/`で囲まれており、これが正規表現であることを表す。

## 数字を探すところから始まる「\d」
ここからはこちらのサイトで実際に正規表現を作ってみる。  
<https://rubular.com/>

正規表現を使って、この文字列内の数字を探してみる。

```
名前：ほげ捕鯨
電話：03-1234-5678
住所：捕鯨県風雨市刃町1-2-3
```

数字はこのようにして表現できる。

```
/\d/
```

正規表現の`/`で囲まれてる入力欄に`\d`を入れると、数字だけ背景が変わるのがわかる。  
これが**「半角数字1個（0〜9）」**を表すものである。

このように、正規表現では特殊な文字を使用して検索を行う。これは**メタ文字**と呼ばれている。

## 電話番号を探す
数字を探すことができたので、電話番号だけを探してみる。  
電話番号は基本的に「xx-xxxx-xxxx」のような形をとるので・・・

```
\d\d-\d\d\d\d-\d\d\d\d
```

これで電話番号を探すことができた。  
`\d`が半角数字1個で、間に「-」を挟めば上のような形の電話番号が探せるというわけだ。  
もちろん電話番号の数字を変えても同じように検索に引っかかる。

## より柔軟な電話番号検索 「{n,m}」
しかし、電話番号の形式はこれだけではない。  
携帯の電話番号は「xxx-xxxx-xxxx」だし、市外局番によっては「xxx-xxx-xxxx」とかもある。

次はこれらにも対応できるような正規表現を書いていく。  
テストデータとして色々な形の電話番号を追加する。

```
名前：ほげ捕鯨
電話：03-1234-5678
電話：090-1234-5678
電話：0795-12-3456
電話：04992-1-2345
住所：捕鯨県風雨市刃町1-2-3
```

文字数が違うため、さっきの`\d`だけではこれら全ての番号に対応できないだろう。  
そこで、この「文字数」を指定する表現を使っていく。

```
{n}
{n,m}
```

`n`と`m`には数字が入り、「直前に指定した文字がn〜m個」を表す。  
`n`だけで書くと「直前に指定した文字がぴったりn個」という風に限定できる。

見た感じ数字の並びは「2〜5個」「1〜4個」「4個」となっているので、  

```
\d{2,5}-\d{1,4}-\d{4}
```

これで全ての電話番号が検索できた。

## 表記のブレを吸収する 「[ABC]」
これで結構な範囲の電話番号が検索できたが、これ以外にも表記のブレがある。  
「xx(xxxx)xxxx」といったように、カッコで書いたりする場合があるのだ。

```
名前：ほげ捕鯨
電話：03(1234)5678
電話：090-1234-5678
電話：0795(12)3456
電話：04992-1-2345
住所：捕鯨県風雨市刃町1-2-3
```

つまり、この場合は「-」か「()」のどちらにも引っかかるような正規表現が必要になる。

正規表現では「指定したどれか1文字」を表すための表現がある。

```
[ABC]
```

これで、「AかBかCのどれか1文字」を表すことができる。  
「-」「(」、あるいは「-」「)」のどちらかを検索する場合は

```
[-(]
[-)]
```

これで表現できる。これを使って、

```
\d{2,5}[-(]\d{1,4}[-)]\d{4}
```

これでカッコを使う場合にも対応できるようになった。

## ハイフンが特殊な意味を持つ場合 「[a-z]」
「-」は特殊な意味を持つ場合がある。  
「[]」内で特定の書き方をすることで、文字の範囲を指定することができる。

```
[a-z]
```

これで「a〜zのうちどれか1文字」になる。同様に、

```
[A-Z]
[0-9]
```

は「A〜Zのうちどれか1文字」「0〜9のうちどれか1文字」となる。  
これらは繋げて書けるので、

```
[a-zA-Z0-9]
```

これで「a〜z、A〜Z、0〜9のうちどれか1文字」（つまり「半角英数字1文字」）という表現ができる。

### ただし・・・
`[-09]`や`[az-]`では通常のハイフンとして扱われる。ここは注意が必要。

```
[-09] -> 「-」か「0」か「9」のうちどれか1文字
[az-] -> 「a」か「z」か「-」のうちどれか1文字
```

## 検索の精度
```
\d{2,5}[-(]\d{1,4}[-)]\d{4}
```
これでほとんどの電話番号は検索できるようになったが、この正規表現にはいくつか穴がある。

```
9999-99-9999
03(1234-5678
```
このようなイレギュラーなものも引っかかってしまうのだ。

正規表現においては、イレギュラーを完全に除外するようなものを作るのはとても難しいとされている。  
大抵の場合においては、「検索の精度」と「正規表現の複雑さ」はトレードオフになる。

100%を目指すか、ある程度の精度で妥協するかはその時に判断が必要だろう。