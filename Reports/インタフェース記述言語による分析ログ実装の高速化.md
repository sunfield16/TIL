# 資料
コード作成からログ定義書作成まで自動化! 転生したらスライムだった件 魔王と竜の建国譚 におけるインタフェース記述言語による分析ログ実装の高速化
https://cedil.cesa.or.jp/cedil_sessions/view/2605

# 従来のログ実装の課題
## ログを利用するまでの流れ
* ログ出力の実装
  - 処理内でカラムを手入力
* データ分析基盤での準備（テーブル定義の作成）
  - SQLなども準備
  - カラムは手入力
* クエリの実行（ログの中身を理解してないとダメ）
  - 名前からカラムの意味が分からないことも
* 分析チームやCSチームなど、使う人への説明資料作成
  - カラムは手入力

-> どの手順も時間がかかる

## 目標
* コードの手書き量の削減
* 分析基盤の自動化
* 説明書作成の自動化

-> 定義ファイルみたいなものを作って自動化できる？

# インタフェース記述言語(IDL)
* 定義ファイルとしての扱いやすさから、IDLを採用
  - 情報量
  - 1行で記述できる視認性

## IDLから自動生成
* PHPのログ出力処理用クラス
  - クラスのプロパティ
  - コンストラクタ
* テーブル定義ファイル
  - IDLからカラムの型に変換
* 説明書のもとになるCSVファイル
  - 各カラムの名前や型
  - カラムの説明文
  
-> Pythonでスクリプトを組んで自動生成

## IDLに含めたもの
* カラム名
* 型情報
* デフォルト値
* カラム説明
* 補足情報

## IDLを活用する
* 一度取り込まれたカラムの削除は不可にする
  - `fbs`ファイルの削除差分がないことを確認する
* 複数のプラットフォームの予約語を禁止

-> IDLの定義ファイルを確認するシェルスクリプトを作り、CIで自動検知

# 導入後の効果
## 実装の効率化
* 設計レビューに集中できる
* 修正は`fbs`ファイルだけでよくなった
* 実装時間の短縮
  - PHPのログ出力用クラスは自動生成
  - あとはそのクラスを使って出力側の処理を書くだけ
* 誰でも対応できるようになった

## ログ定義の共有
* 統一された記述
* ログのカラムや型の情報が集約された
* 共有しやすくなった
  - 社外の人にも、IDL -> CSVから生成した資料を渡せばOK

# 改善できそうなところ
## 補足情報のフォーマットが未統一
補足情報は自由入力だが、フォーマットはある程度決めておくべき

* 例:カラムに入る値がEnumの場合
  - `0:NONE 1:UPSERT 2:DELETE`みたいな形式だったり、`[NONE/UPSERT/DELETE]`みたいな形式だったりした