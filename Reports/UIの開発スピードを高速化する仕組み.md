# 参考資料
CEDEC 2022  
UIの開発スピードを高速化する仕組み  

# 「ヘブンバーンズレッド」でのUI作成
* UnityのuGUIで作成している
* 数はとても多い（365個くらい）
  - 当然スピードが必要になる

## 作業のワークフロー
デザイナーとプログラマーが役割分担して行う

* 素材作成
  - レイアウト作成
  - アニメーション作成
  - 説明をつける
* コード実装
  - フィールドとオブジェクトの紐付け
  - データバインド
  - 組み込み
* 動作確認と調整
  - 実際のシーンで確認
  - ブラッシュアップ

# 素材作成
* レイアウト ... `.psd`をもとに、UnityのPrefabに落とし込んでいく
* アニメーション ... `Animator`や`Animation`など、リソースの変更で完結
* 説明をつける ... UIの仕様書を作成していたが、書くのも更新も時間がかかる
  - 見やすく作る必要がある
  - 実装とのズレが生じる可能性がある
  - 変更するたびに修正が必要

## UI仕様書ではなくコンポーネントで解決
* コンポーネントのフィールドに識別名や説明文を書けるようにする
  - そのオブジェクトを見ただけで、UI仕様書に書かれるような内容を把握できる
    - このテキストに何の情報を表示するか
    - このボタンを押すと何が起きるか
    - ここに何の画像を入れるか

-> PrefabにUI仕様書の情報を埋め込む

# コード実装
## Prefabからコードの自動生成
* UIの表示に必要なデータ群（Entity）の定義を自動で作成
* Entityの各内容はSerializeFieldとして外からも渡せるように

## フィールドとオブジェクトの紐付け
### よくある方法の問題点
* `Awake`でコードから全探索して1つずつ紐づける
  - 全探索によって無駄な処理がある
  - 探索処理が肥大化する
* 手動でドラッグして1つずつ参照を付ける
  - 手動のため手間がかかる
  - フィールド名を変えただけで参照が外れる

### エディタスクリプトを使う
* エディタスクリプトで、自動で参照を付けるようにする
  - そもそも探索処理を書かなくてよくなる
  - 手動で行う必要なし
  - フィールドが変わっても大丈夫

-> 自動生成で実装を短縮

## データの紐付け
プレハブから実際にオブジェクトを生成して、  
データを置き換える処理。

* 外部からEntityを受け取るようにして、Entityの内容をUIに反映

### よくあるデータバインド
* uGUIに依存してる
  - プロパティとかメソッドを知らないといけない

### コンポーネントをラップする
* コンポーネントをラップして、uGUIの依存を切る
  - TextやButtonなど、それぞれを使いやすい形に
  - 組み込み側からはこのクラスを通して設定を行う
    - これによって、組み込み側ではuGUIのプロパティとかを知らなくて良くなる
```csharp
// ラップしたクラスのイメージ
public class UIText : MonoBehavior
{
  [SerializeField] private Text text;
  public void Set(string text)
  {
    this.text.text = text;
  }

  // intも受け取れるように
  public void Set(int text)
  {
    this.text.text = text.ToString();
  }
}
```

* 表示や振る舞いに必要なのは変数だけという考え方
  - Textならstring, ButtonならUnityActionなどがあればいい

## テストシーンでのUI調整
* コンポーネントに入っているデータはインスペクターで調整できるように

# 動作確認と調整
## 実際のシーンでの確認
* プレビューシーンを作成する
  - 組み込まなくても単体で確認
  - テストデータを入れて簡単に編集
    - Entityにテスト用データを入れればOK

## プレビューシーンを自動生成
* プレビュー用にテストコントローラーのコンポーネントを作成
* UIごとのプレビューシーンを作成

## アニメーションのデバッグ
* In, Outボタンをプレビューシーンに設置
  - それぞれシーンに入ったとき、出るときの挙動を再現

# おまけ
## リストビューの作成
* 子クラスのEntityのコードを自動生成
  - リストの要素のPrefabから、UIで必要なデータを抜き出す
* 子クラスのリストコンポーネントを設定する
  - Scrollviewにコンポーネントをつけて、子クラスのEntityのリストを設定できるように
* 親クラスのEntityのコードを自動生成

## UIを探すエディター拡張
* `AssetDatabase.FindAssets`でUIプレビュー用のシーンを検索
* インクリメンタルサーチを行う処理

# まとめ
## 自動生成による恩恵
* 新しい人が入ってきても実装の内容が変わらない
* 同じような内容を書かなくて済む
* テストデータを作りやすい

## イテレーションの高速化
* 作成や修正・確認から完成までのサイクルが早くなった